var date,origin,token="",sort=" sort:reactions-+1",unauthorized=!0;const regex=/<!--([^)]+)-->/;var example_post=$(".post").clone().removeClass("visually-hidden");function get_origin(){let t=new Date;origin=t.getUTCFullYear()+"-"+String(t.getUTCMonth()+1).padStart(2,"0")+"-"+String(t.getUTCDate()).padStart(2,"0")}async function verify_login(){Cookies.get("token")&&($("#github-login-button").addClass("visually-hidden"),$("#exit-button").removeClass("visually-hidden"),token=Cookies.get("token")),trends()}async function login(){window.location.replace("https://github.com/login/oauth/authorize?client_id=0d1b74e91be0580beb25&redirect_uri=https://git.buzl.uk/oauth.html&scope=public_repo read:user")}async function logout(){Cookies.remove("token"),window.location.replace("/")}async function upvote(t){if(!token.length)return;let e=$(t).attr("url");await add_upvote_reaction(e)}async function downvote(t){if(!token.length)return;let e=$(t).attr("url");await add_downvote_reaction(e)}async function trends(){$("#empty-message").addClass("visually-hidden"),$(".post").remove();let t=(date=new Date).getUTCFullYear()+"-"+String(date.getUTCMonth()+1).padStart(2,"0")+"-"+String(date.getUTCDate()).padStart(2,"0");var e=await get_issues(t);e.hasOwnProperty("total_count")||!unauthorized?0!=e.total_count?e.items.forEach(displayPost):$("#empty-message").removeClass("visually-hidden"):$("#login-message").removeClass("visually-hidden")}async function trends_date(){$("#empty-message").addClass("visually-hidden"),$(".post").remove();let t=date.getUTCFullYear()+"-"+String(date.getUTCMonth()+1).padStart(2,"0")+"-"+String(date.getUTCDate()).padStart(2,"0");var e=await get_issues(t);e.hasOwnProperty("total_count")||!unauthorized?0!=e.total_count?e.items.forEach(displayPost):$("#empty-message").removeClass("visually-hidden"):$("#login-message").removeClass("visually-hidden")}async function trends_yesterday(){$("#trends-tomorrow-button").removeClass("visually-hidden"),$("#empty-message").addClass("visually-hidden"),$(".post").remove(),date.setDate(date.getDate()-1);let t=date.getUTCFullYear()+"-"+String(date.getUTCMonth()+1).padStart(2,"0")+"-"+String(date.getUTCDate()).padStart(2,"0");$("#date").text(t);var e=await get_issues(t);e.hasOwnProperty("total_count")||!unauthorized?0!=e.total_count?e.items.forEach(displayPost):$("#empty-message").removeClass("visually-hidden"):$("#login-message").removeClass("visually-hidden")}async function trends_tomorrow(){$("#empty-message").addClass("visually-hidden"),$(".post").remove(),date.setDate(date.getDate()+1);let t=date.getUTCFullYear()+"-"+String(date.getUTCMonth()+1).padStart(2,"0")+"-"+String(date.getUTCDate()).padStart(2,"0");t==origin?($("#trends-tomorrow-button").addClass("visually-hidden"),$("#date").text("Today")):$("#date").text(t);var e=await get_issues(t);e.hasOwnProperty("total_count")||!unauthorized?0!=e.total_count?e.items.forEach(displayPost):$("#empty-message").removeClass("visually-hidden"):$("#login-message").removeClass("visually-hidden")}function displayPost(t){let e=$(example_post).clone(),o=t.body.match(regex);o&&$(e).find(".post-image").attr("src",o[1]),$(e).removeClass("visually-hidden"),$(e).find(".post-title").text(t.title.substring(10)),$(e).find(".post-body").text(t.body),$(e).find(".post-link").attr("href","post.html?issue="+t.url.split("https://api.github.com/repos/")[1]),$(e).find(".upvote-button").attr("url",t.url+"/reactions"),$(e).find(".downvote-button").attr("url",t.url+"/reactions"),$(e).find(".post-user").attr("href","user.html?user="+t.user.login),$(e).find(".post-user").text(t.user.login),$(e).find(".post-user-image").attr("src",t.user.avatar_url),$(e).find(".post-score").text("ðŸ”¥ "+t.reactions["+1"]),$("#post-feed").append(e)}function get_issues(t){return console.log(t),fetch("https://api.github.com/search/issues?q="+encodeURIComponent('"#gitlounge" created:'+t+" "+sort),{method:"GET",headers:{Accept:"application/vnd.github+json",Authorization:`token ${token}`}}).then((t=>t.json()))}function add_upvote_reaction(t){return fetch(t,{method:"POST",headers:{Accept:"application/vnd.github+json",Authorization:`token ${token}`},body:JSON.stringify({content:"+1"})}).then((t=>!!t.ok))}function add_downvote_reaction(t){return fetch(t,{method:"POST",headers:{Accept:"application/vnd.github+json",Authorization:`token ${token}`},body:JSON.stringify({content:"-1"})}).then((t=>!!t.ok))}function changeSort(){sort=$("#sortSelect option:selected").val(),trends_date(),console.log(sort)}get_origin(),verify_login();